<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Configurações - Regulador MV</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <h1>Configurações</h1>

    <fieldset class="settings-section">
      <legend>Geral</legend>
      <form id="settings-form">
        <div class="form-group">
          <label for="itemsPerPage">Itens por página nas tabelas:</label>
          <input type="number" id="itemsPerPage" name="itemsPerPage" min="5" max="50" />
        </div>
        <div class="form-group">
          <label for="prontuarioPeriodoPadrao"
            >Período padrão para análise de prontuário:</label
          >
          <select id="prontuarioPeriodoPadrao" name="prontuarioPeriodoPadrao">
            <option value="last_6_months">Últimos 6 meses</option>
            <option value="last_year" selected>Último ano</option>
            <option value="all_time">Todo o período</option>
          </select>
        </div>
        <button type="submit">Guardar Gerais</button>
      </form>
    </fieldset>

    <fieldset class="settings-section">
      <legend>Gerenciador de Tags Clínicas</legend>
      <div id="tag-builder">
        <!-- Nome da Tag e Cores -->
        <div class="form-group-row">
          <div class="form-group" style="flex-grow: 1">
            <label for="tagName">Nome da Nova Tag (ou editar existente):</label>
            <input
              type="text"
              id="tagName"
              placeholder="Ex: Risco Cardiovascular, Acamado, Alergias"
            />
          </div>
          <div class="color-picker-group">
            <div class="form-group">
              <label for="tagBgColor">Fundo</label>
              <input type="color" id="tagBgColor" value="#fca5a5" />
            </div>
            <div class="form-group">
              <label for="tagTextColor">Texto</label>
              <input type="color" id="tagTextColor" value="#991b1b" />
            </div>
          </div>
        </div>

        <!-- Seletor de Tipo de Tag -->
        <div class="form-group">
          <label>Tipo de Tag:</label>
          <div class="tag-type-selector">
            <input type="radio" id="typeCode" name="tagType" value="code" checked />
            <label for="typeCode">Por Código (CID/CIAP)</label>
            <input type="radio" id="typeKeyword" name="tagType" value="keyword" />
            <label for="typeKeyword">Por Palavra-Chave</label>
          </div>
        </div>

        <!-- Container do Construtor de Códigos -->
        <div id="code-builder-container">
          <div class="form-group">
            <label for="tagCodeSearch">Pesquisar Códigos:</label>
            <input
              type="text"
              id="tagCodeSearch"
              placeholder="Pesquise por nome (ex: diabetes) ou código (ex: I10)"
            />
            <div id="search-container" class="search-container">
              <div id="code-search-results"></div>
              <div id="search-actions" class="search-actions" style="display: none">
                <div class="selection-toggles">
                  <button type="button" id="selectAllBtn" class="link-button">
                    Selecionar Todos
                  </button>
                  <span>|</span>
                  <button type="button" id="deselectAllBtn" class="link-button">
                    Limpar Seleção
                  </button>
                </div>
                <div class="main-actions">
                  <button id="addSelectedBtn" type="button">
                    Adicionar Selecionados
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Container do Construtor de Palavras-Chave -->
        <div id="keyword-builder-container" style="display: none">
          <div class="form-group">
            <label>Lógica de Combinação das Regras:</label>
            <div class="tag-type-selector">
              <input type="radio" id="logicOR" name="matchLogic" value="OR" checked />
              <label for="logicOR">Corresponder a QUALQUER UMA (OU)</label>
              <input type="radio" id="logicAND" name="matchLogic" value="AND" />
              <label for="logicAND">Corresponder a TODAS (E)</label>
            </div>
          </div>
          <div class="rule-builder form-group">
            <label>Adicionar Nova Regra:</label>
            <div class="rule-input-group">
              <select id="ruleMatchType">
                <option value="contains" selected>Contém</option>
                <option value="not_contains">Não Contém</option>
                <option value="regex">Regex</option>
              </select>
              <input
                type="text"
                id="ruleValue"
                placeholder="Digite a palavra-chave ou regex"
              />
              <button id="addRuleBtn" type="button">Adicionar Regra</button>
            </div>
            <div id="regex-validator"></div>
          </div>
        </div>

        <!-- Lista de Itens (comum a ambos os tipos) -->
        <div class="form-group">
          <label>Itens Associados a esta Tag:</label>
          <div id="associated-items" class="pills-container"></div>
        </div>

        <button id="saveTagBtn" type="button">Guardar Tag</button>
      </div>
    </fieldset>

    <fieldset class="settings-section">
      <legend>Tags Salvas</legend>
      <div id="tag-list"></div>
    </fieldset>

    <div id="status"></div>

    <div class="feedback-section">
      <h2>Feedback & Suporte</h2>
      <p>Encontrou um problema ou tem uma sugestão? Ajude a melhorar a extensão!</p>
      <a
        href="https://github.com/BugCheckBr/mvRegulador/issues"
        target="_blank"
        class="feedback-link"
        >Reportar um Problema ou Sugerir Melhoria</a
      >
    </div>

    <script type="module" src="options.js"></script>
  </body>
</html>
